<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¥ë°”êµ¬ë‹ˆ</title>
    <style>
        body { font-family: 'Apple SD Gothic Neo', sans-serif; background: #f8f9fa; margin: 0; padding: 20px; color: #333; }
        .cart-card { background: white; border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); margin-bottom: 25px; overflow: hidden; }
        .cat-title { background: #2ecc71; color: white; padding: 15px; font-weight: bold; font-size: 18px; }
        .item { padding: 15px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; }
        .price-box { text-align: right; padding: 20px; background: #fafafa; border-top: 2px solid #eee; }
        .total-row { font-size: 20px; font-weight: bold; color: #e74c3c; margin-top: 10px; }
        .status-msg { padding: 10px; border-radius: 8px; text-align: center; margin-top: 10px; font-weight: bold; }
        .msg-error { background: #fff5f5; color: #e74c3c; border: 1px solid #feb2b2; }
        .msg-ok { background: #f0fff4; color: #2ecc71; border: 1px solid #9ae6b4; }
        .btn-order { width: 100%; padding: 15px; border: none; border-radius: 10px; font-size: 18px; font-weight: bold; cursor: pointer; margin-top: 10px; transition: 0.3s; }
        .btn-ready { background: #2ecc71; color: white; }
        .btn-disabled { background: #ddd; color: #999; cursor: not-allowed; }
    </style>
</head>
<body>

<h2 style="text-align: center; margin-bottom: 30px;">ğŸ›’ ì¥ë°”êµ¬ë‹ˆ</h2>

{% for cat, items in grouped_cart.items() %}
    {% set ns = namespace(subtotal=0) %}
    {% for item in items %}
        {% set ns.subtotal = ns.subtotal + (item.product.price_retail * item.quantity) %}
    {% endfor %}

    <div class="cart-card">
        <div class="cat-title">ğŸ“¦ {{ cat }} ë°°ì†¡</div>
        
        {% for item in items %}
        <div class="item">
            <div>
                <div style="font-weight: bold;">{{ item.product.name }}</div>
                <div style="font-size: 13px; color: #666;">{{ item.product.spec }} / {{ item.quantity }}ê°œ</div>
            </div>
            <div style="font-weight: bold;">{{ "{:,}".format(item.product.price_retail * item.quantity) }}ì›</div>
        </div>
        {% endfor %}

        <div class="price-box">
            <div style="color: #666;">ìƒí’ˆ ê¸ˆì•¡: {{ "{:,}".format(ns.subtotal) }}ì›</div>
            <div style="color: #666;">ë°°ì†¡ë¹„: +{{ "{:,}".format(delivery_fee) }}ì›</div>
            <div class="total-row">í•©ê³„: {{ "{:,}".format(ns.subtotal + delivery_fee) }}ì›</div>

            {% if ns.subtotal < min_price %}
                <div class="status-msg msg-error">âš ï¸ 10,000ì› ì´ìƒ ë‹´ì•„ì£¼ì„¸ìš” (í˜„ì¬ {{ "{:,}".format(min_price - ns.subtotal) }}ì› ë¶€ì¡±)</div>
                <button class="btn-order btn-disabled" disabled>ê¸ˆì•¡ ë¶€ì¡±</button>
            {% else %}
                <div class="status-msg msg-ok">âœ… ì£¼ë¬¸ ê°€ëŠ¥í•œ ê¸ˆì•¡ì…ë‹ˆë‹¤!</div>
                <button class="btn-order btn-ready" onclick="location.href='/order/{{ cat }}'">{{ cat }} ì£¼ë¬¸í•˜ê¸°</button>
            {% endif %}
        </div>
    </div>
{% endfor %}

<p style="text-align: center;"><a href="/" style="color: #2ecc71; text-decoration: none;">â† ìƒí’ˆ ë” ë‹´ìœ¼ëŸ¬ ê°€ê¸°</a></p>

</body>
</html>